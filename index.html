<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location & Motion Sensor Test</title>
</head>
<body>
    <h1>Location & Motion Test</h1>
    <p id="status">Checking permissions...</p>
    <p id="location">Location: Not available</p>
    <div id="sensor-data">Motion Data: Not available</div>

    <script>
        // Function to get user location
        function getLocation() {
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        document.getElementById("location").innerText = 
                            `Latitude: ${position.coords.latitude.toFixed(5)}, 
                            Longitude: ${position.coords.longitude.toFixed(5)}`;
                    },
                    (error) => {
                        document.getElementById("location").innerText = "Location access denied.";
                        console.error("Location error:", error);
                    }
                );
            } else {
                document.getElementById("location").innerText = "Geolocation not supported.";
            }
        }

        // Function to request motion permissions
        function requestMotionPermission() {
            if (typeof DeviceMotionEvent.requestPermission === "function") {
                DeviceMotionEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === "granted") {
                            startMotionTracking();
                            document.getElementById("status").innerText = "Motion sensors enabled!";
                        } else {
                            document.getElementById("status").innerText = "Motion permission denied.";
                        }
                    })
                    .catch(error => {
                        document.getElementById("status").innerText = "Error: " + error;
                    });
            } else {
                startMotionTracking();
                document.getElementById("status").innerText = "Motion sensors active!";
            }
        }

        function startMotionTracking() {
            window.addEventListener("devicemotion", (event) => {
                document.getElementById("sensor-data").innerText = `
Acceleration:
X: ${event.accelerationIncludingGravity.x?.toFixed(2)}
Y: ${event.accelerationIncludingGravity.y?.toFixed(2)}
Z: ${event.accelerationIncludingGravity.z?.toFixed(2)}
                `;
            });

            window.addEventListener("deviceorientation", (event) => {
                document.getElementById("sensor-data").innerText += `
Orientation:
Alpha: ${event.alpha?.toFixed(2)}
Beta: ${event.beta?.toFixed(2)}
Gamma: ${event.gamma?.toFixed(2)}
                `;
            });
        }

        // Auto-request location on page load
        window.onload = function () {
            getLocation(); // Get user location

            if (typeof DeviceMotionEvent.requestPermission === "function") {
                // iOS requires a button click for motion permission
                let btn = document.createElement("button");
                btn.innerText = "Enable Motion Sensors";
                btn.onclick = requestMotionPermission;
                document.body.appendChild(btn);
            } else {
                // Non-iOS, start motion tracking automatically
                requestMotionPermission();
            }
        };
    </script>
</body>
</html>
